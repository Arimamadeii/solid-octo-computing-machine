<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>System Part Number Generator</title>
    <style>
        /* Clock Styles */
        .jakarta-clock {
            position: fixed;
            top: 10px;
            left: 10px;
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 10px 15px;
            border-radius: 5px;
            font-family: Arial, sans-serif;
            font-size: 14px;
            z-index: 1001;
        }
        .clock-time {
            font-size: 18px;
            font-weight: bold;
        }
        .clock-date {
            font-size: 12px;
            margin-top: 3px;
        }

        /* Login Modal Styles */
        .login-modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.7);
        }
        .login-content {
            background-color: #fefefe;
            margin: 15% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 300px;
            border-radius: 5px;
            box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2);
        }
        .login-content h2 {
            text-align: center;
            color: #2c3e50;
        }
        .login-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        .login-form input {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .login-form button {
            padding: 10px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .login-form button:hover {
            background-color: #45a049;
        }
        .error-message {
            color: red;
            text-align: center;
            margin-top: 10px;
            display: none;
        }
        
        /* Add Option Modal Styles */
        .add-option-modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.7);
        }
        .add-option-content {
            background-color: #fefefe;
            margin: 15% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 400px;
            border-radius: 5px;
            box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2);
        }
        .add-option-content h2 {
            text-align: center;
            color: #2c3e50;
        }
        .add-option-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        .add-option-form input, .add-option-form select {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .add-option-form button {
            padding: 10px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .add-option-form button:hover {
            background-color: #45a049;
        }
        .form-buttons {
            display: flex;
            gap: 10px;
        }
        .cancel-btn {
            background-color: #e74c3c;
        }
        
        /* Dropdown with Add Button Styles */
        .dropdown-with-add {
            display: flex;
            gap: 5px;
        }
        .dropdown-with-add select {
            flex: 1;
        }
        .add-btn {
            padding: 8px 12px;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .add-btn:hover {
            background-color: #2980b9;
        }
        .add-btn:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }
        
        /* Pocket Input Styles */
        .pocket-input {
            display: none;
            margin-top: 10px;
        }
        
        /* Search Box Styles */
        .search-container {
            margin-bottom: 15px;
            display: flex;
            gap: 10px;
        }
        .search-container input {
            flex: 1;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .search-container button {
            padding: 8px 15px;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .search-container button:hover {
            background-color: #2980b9;
        }
        
        /* Main Application Styles */
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            padding-top: 40px; /* Added to prevent content from being hidden under clock */
        }
        .container {
            display: flex;
            flex-direction: column;
            gap: 15px;
            max-width: 1200px;
            margin: 0 auto;
        }
        .header {
            text-align: center;
            margin-bottom: 20px;
        }
        .header h1 {
            color: #2c3e50;
            margin-bottom: 5px;
        }
        .section {
            border: 1px solid #ddd;
            padding: 15px;
            border-radius: 5px;
        }
        .section-title {
            font-weight: bold;
            margin-bottom: 10px;
            font-size: 18px;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        select, input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        .dimensions {
            display: flex;
            gap: 10px;
        }
        .dimension-input {
            flex: 1;
        }
        .generate-section {
            text-align: center;
            margin-top: 20px;
        }
        button {
            padding: 10px 20px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }
        button:hover {
            background-color: #45a049;
        }
        .result {
            margin-top: 20px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: #f9f9f9;
        }
        .copy-btn {
            background-color: #3498db;
            margin-left: 10px;
        }
        .copy-btn:hover {
            background-color: #2980b9;
        }
        .qr-container {
            margin-top: 15px;
            text-align: center;
        }
        .qr-value {
            text-align: left;
            margin-top: 5px;
            font-family: monospace;
            white-space: pre-wrap;
            background-color: #f0f0f0;
            padding: 8px;
            border-radius: 4px;
        }
        .flex-row {
            display: flex;
            align-items: center;
        }
        #qr-code {
            width: 200px;
            height: 200px;
            margin: 0 auto;
            border: 1px solid #ddd;
            padding: 10px;
            background: white;
        }
        .save-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 10px;
        }
        .save-btn {
            padding: 8px 15px;
            background-color: #5cb85c;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        .save-btn:hover {
            background-color: #4cae4c;
        }
        .data-section {
            margin-top: 30px;
        }
        .category-tabs {
            display: flex;
            gap: 5px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        .category-tab {
            padding: 8px 15px;
            background-color: #e0e0e0;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .category-tab.active {
            background-color: #4CAF50;
            color: white;
        }
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        .data-table th, .data-table td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        .data-table th {
            background-color: #f2f2f2;
            position: sticky;
            top: 0;
        }
        .data-table tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        .data-table tr:hover {
            background-color: #f1f1f1;
        }
        .table-container {
            max-height: 500px;
            overflow-y: auto;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .action-buttons {
            display: flex;
            gap: 5px;
        }
        .action-btn {
            padding: 3px 8px;
            font-size: 12px;
            border-radius: 3px;
        }
        .view-btn {
            background-color: #3498db;
            color: white;
        }
        .delete-btn {
            background-color: #e74c3c;
            color: white;
        }
        .no-data {
            text-align: center;
            padding: 20px;
            color: #777;
        }
        .clear-data-btn {
            background-color: #e74c3c;
            margin-top: 10px;
        }
        .clear-data-btn:hover {
            background-color: #c0392b;
        }
        .export-btn {
            background-color: #2ecc71;
            margin-top: 10px;
        }
        .export-btn:hover {
            background-color: #27ae60;
        }
        .farrindo-logo {
            position: fixed;
            top: 10px;
            right: 10px;
            z-index: 1001;
        }
    </style>
    <script src="https://cdn.rawgit.com/davidshimjs/qrcodejs/gh-pages/qrcode.min.js"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <script src="https://cdn.sheetjs.com/xlsx-0.19.3/package/dist/xlsx.full.min.js"></script>
</head>
<body>
    <!-- Farrindo Logo -->
    <div class="farrindo-logo">
        <img src="https://www.farrindo.co.id/wp-content/uploads/2025/01/300x39-logofarrindo2025bawahbanget.webp" alt="Farrindo Logo" width="150" height="20">
    </div>

    <!-- Jakarta Clock -->
    <div class="jakarta-clock">
        <div>Jakarta, Indonesia</div>
        <div class="clock-time" id="jakarta-time"></div>
        <div class="clock-date" id="jakarta-date"></div>
    </div>

    <!-- Login Modal -->
    <div id="loginModal" class="login-modal">
        <div class="login-content">
            <h2>Login Required</h2>
            <form class="login-form" onsubmit="return validateLogin()">
                <input type="text" id="username" placeholder="Username" required>
                <input type="password" id="password" placeholder="Password" required>
                <button type="submit">Login</button>
            </form>
            <div id="loginError" class="error-message">Invalid username or password</div>
        </div>
    </div>

    <!-- Add Option Modal -->
    <div id="addOptionModal" class="add-option-modal">
        <div class="add-option-content">
            <h2 id="addOptionTitle">Add New Option</h2>
            <form class="add-option-form" onsubmit="return saveNewOption()">
                <div id="categorySelection" style="display: none;">
                    <label for="parentCategory">Category</label>
                    <select id="parentCategory" required>
                        <option value="">-- Select Category --</option>
                        <option value="01">01. Filter</option>
                        <option value="02">02. Sheetmetal</option>
                        <option value="03">03. Bahan baku</option>
                        <option value="04">04. Barang jadi</option>
                        <option value="05">05. Jasa</option>
                        <option value="06">06. Subcount</option>
                    </select>
                </div>
                <div id="subCategorySelection" style="display: none;">
                    <label for="parentSubCategory">Sub Category</label>
                    <select id="parentSubCategory" required>
                        <option value="">-- Select Sub Category --</option>
                    </select>
                </div>
                <div id="codeFieldGroup">
                    <label for="newOptionCode">Code</label>
                    <input type="text" id="newOptionCode">
                </div>
                <div>
                    <label for="newOptionName">Name</label>
                    <input type="text" id="newOptionName" required>
                </div>
                <div class="form-buttons">
                    <button type="submit">Save</button>
                    <button type="button" class="cancel-btn" onclick="closeAddOptionModal()">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Main Content (hidden until login) -->
    <div id="mainContent" style="display: none;">
        <div class="container">
            <div class="header">
                <h1>System Part Number Generator</h1>
            </div>
            
            <div class="section">
                <div class="section-title">Kategori</div>
                
                <div class="form-group">
                    <label for="category">Kategori</label>
                    <select id="category" onchange="updateSubCategories()">
                        <option value="">-- Pilih Kategori --</option>
                        <option value="01">01. Filter</option>
                        <option value="02">02. Sheetmetal</option>
                        <option value="03">03. Bahan baku</option>
                        <option value="04">04. Barang jadi</option>
                        <option value="05">05. Jasa</option>
                        <option value="06">06. Subcount</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="subCategory">Sub Kategori</label>
                    <div class="dropdown-with-add">
                        <select id="subCategory" onchange="updateProductNames()" disabled>
                            <option value="">-- Pilih Sub Kategori --</option>
                        </select>
                        <button class="add-btn" onclick="showAddOptionModal('subCategory')">+</button>
                    </div>
                </div>
                
                <div class="form-group" id="productNameGroup">
                    <label for="productName">Nama Product</label>
                    <div class="dropdown-with-add">
                        <select id="productName" onchange="updateMaterialOptions()" disabled>
                            <option value="">-- Pilih Nama Product --</option>
                        </select>
                        <button class="add-btn" onclick="showAddOptionModal('productName')">+</button>
                    </div>
                </div>
                
                <div class="form-group" id="materialGroup">
                    <label for="material">Bahan/Media Utama</label>
                    <div class="dropdown-with-add">
                        <select id="material" disabled>
                            <option value="">-- Pilih Bahan/Media --</option>
                        </select>
                        <button class="add-btn" id="materialAddBtn" onclick="showAddOptionModal('material')" disabled>+</button>
                    </div>
                </div>

                <!-- Pocket Input Field -->
                <div class="form-group pocket-input" id="pocketInputGroup">
                    <label for="pocketCount">Number of Pockets</label>
                    <input type="number" id="pocketCount" min="1" value="1">
                </div>
            </div>
            
            <div class="section">
                <div class="section-title">Ukuran (mm)</div>
                
                <div class="form-group">
                    <div class="dimensions">
                        <div class="dimension-input">
                            <label for="length">Panjang</label>
                            <input type="number" id="length" min="0" onchange="generateSizeCode()">
                        </div>
                        <div class="dimension-input">
                            <label for="width">Lebar</label>
                            <input type="number" id="width" min="0" onchange="generateSizeCode()">
                        </div>
                        <div class="dimension-input">
                            <label for="height">Tinggi</label>
                            <input type="number" id="height" min="0" onchange="generateSizeCode()">
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="sizeCode">Kode Ukuran</label>
                    <input type="text" id="sizeCode" readonly>
                </div>
                
                <div class="form-group">
                    <label for="price">Harga Rp.</label>
                    <input type="number" id="price" min="0">
                </div>
            </div>
            
            <div class="generate-section">
                <button onclick="generatePartNumber()">Generate</button>
            </div>
            
            <div class="result" id="result" style="display: none;">
                <div class="form-group">
                    <label for="partNumber">Part Number</label>
                    <div class="flex-row">
                        <input type="text" id="partNumber" readonly style="flex: 1;">
                        <button class="copy-btn" onclick="copyToClipboard('partNumber')">Copy</button>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>QR Code Data</label>
                    <div class="flex-row">
                        <input type="text" id="qrData" readonly style="flex: 1;">
                        <button class="copy-btn" onclick="copyToClipboard('qrData')">Copy</button>
                    </div>
                    <div class="qr-container">
                        <div id="qr-code"></div>
                        <div class="save-buttons">
                            <button class="save-btn" onclick="saveQRCode('png')">Save as PNG</button>
                            <button class="save-btn" onclick="saveQRCode('jpeg')">Save as JPEG</button>
                        </div>
                        <div class="qr-value" id="qr-text"></div>
                    </div>
                </div>
            </div>
            
            <div class="section data-section">
                <div class="section-title">Data Part Number</div>
                
                <!-- Search Container -->
                <div class="search-container">
                    <input type="text" id="searchInput" placeholder="Search by part number, product, etc...">
                    <button onclick="searchTable()">Search</button>
                </div>
                
                <div class="category-tabs" id="categoryTabs">
                    <button class="category-tab active" onclick="filterDataTable('all')">Semua</button>
                    <button class="category-tab" onclick="filterDataTable('01')">Filter</button>
                    <button class="category-tab" onclick="filterDataTable('02')">Sheetmetal</button>
                    <button class="category-tab" onclick="filterDataTable('03')">Bahan baku</button>
                    <button class="category-tab" onclick="filterDataTable('04')">Barang jadi</button>
                    <button class="category-tab" onclick="filterDataTable('05')">Jasa</button>
                    <button class="category-tab" onclick="filterDataTable('06')">Subcount</button>
                </div>
                
                <div class="table-container">
                    <table class="data-table" id="dataTable">
                        <thead>
                            <tr>
                                <th>No</th>
                                <th>Part Number</th>
                                <th>Kategori</th>
                                <th>Sub Kategori</th>
                                <th>Produk</th>
                                <th>Material</th>
                                <th>Ukuran</th>
                                <th>Harga</th>
                                <th>Aksi</th>
                            </tr>
                        </thead>
                        <tbody id="tableBody">
                            <tr>
                                <td colspan="9" class="no-data">Belum ada data</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div style="text-align: center; margin-top: 15px;">
                    <button class="clear-data-btn" onclick="clearAllData()">Clear All Data</button>
                    <button class="export-btn" onclick="exportToExcel()">Export to Excel</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Clock function for Jakarta, Indonesia (GMT+7)
        function updateJakartaClock() {
            const options = {
                timeZone: 'Asia/Jakarta',
                hour12: false,
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit',
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            };
            
            const now = new Date();
            const jakartaTime = now.toLocaleTimeString('id-ID', {
                timeZone: 'Asia/Jakarta',
                hour12: false,
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
            
            const jakartaDate = now.toLocaleDateString('id-ID', {
                timeZone: 'Asia/Jakarta',
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
            
            document.getElementById('jakarta-time').textContent = jakartaTime;
            document.getElementById('jakarta-date').textContent = jakartaDate;
        }
        
        // Update clock every second
        setInterval(updateJakartaClock, 1000);
        updateJakartaClock(); // Initial call

        // Data structure for saved options
        let savedOptions = {
            categories: [],
            subCategories: {},
            productNames: {},
            materials: []
        };

        // Default data structures
        const defaultSubCategories = {
            '01': [
                {value: '01', text: '01. Pre Filter'},
                {value: '02', text: '02. Medium Filter'},
                {value: '03', text: '03. Hepa Filter'},
                {value: '04', text: '04. Ulpa Filter'},
                {value: '05', text: '05. Cartridge Filter Gasturbine'}
            ],
            '02': [
                {value: '01', text: '01. HVAC Equipment'},
                {value: '02', text: '02. Hospital'},
                {value: '03', text: '03. Accessories'}
            ],
            '03': [],
            '04': [],
            '05': [],
            '06': []
        };
        
        const defaultProductNames = {
            '01-01': [
                {value: '01', text: 'NAF CR Pre Filter Washable Pleated Radial'},
                {value: '02', text: 'NAF CR Pre Filter Washable Flat'},
                {value: '03', text: 'Pre Filter NAF 30 (Disposable)'},
                {value: '04', text: 'NAF CR Pre Filter Washable Flange Type'},
                {value: '05', text: 'NAF CR Prefilter IU'},
                {value: '06', text: 'NAF Multi Pocket Filter / Medium Bag Filter'},
                {value: '07', text: 'Paint Stop Filter'},
                {value: '08', text: 'Pre Filter Carbon Radial Pleated'},
                {value: '09', text: 'Pre Filter Saranet Double Layer (Aluminium Frame)'},
                {value: '10', text: 'Filter Loopseal Flange'},
                {value: '11', text: 'Pre Filter Carbon Active Granular'}
            ],
            '01-02': [
                {value: '01', text: 'NAF V-PAC (2V)'},
                {value: '02', text: 'NAF V Bank Carbon Filter Active 3V'},
                {value: '03', text: 'NAF V-PAC Carbon Filter'},
                {value: '04', text: 'NAF V-PAC Medium Filter'},
                {value: '05', text: 'NAF Rigid Flange Type Stainless Steel'},
                {value: '06', text: 'NAF RIGID Medium Filter'},
                {value: '07', text: 'NAF Multi Pocket Filter / Medium Bag Filter'},
                {value: '08', text: 'NAF Multi Pocket Airweb'},
                {value: '09', text: 'NAF ECO PAC Seri Karton'},
                {value: '10', text: 'NAF ECO PAC Seri Metal'},
                {value: '11', text: 'NAF PAC'},
                {value: '12', text: 'NAF PAC Wooden Frame'},
                {value: '13', text: 'Medium Filter Carbon Multi Layer (3 Stage)'},
                {value: '14', text: 'NAF Rigid Flange Type Stainless Steel (F9)'},
                {value: '15', text: 'Filter Loopseal Flange'}
            ],
            '01-03': [
                {value: '01', text: 'NAF Absolute MX'},
                {value: '02', text: 'NAF Absolute HEPA Minipleat XL – Deep 12 Inch'},
                {value: '03', text: 'NAF Absolute HEPA Minipleat XL – Deep 6 Inch'},
                {value: '04', text: 'NAF Absolute XL | HEPA Filter High Capacity (Aluminium Separator)'},
                {value: '05', text: 'NAF Absolute HEPA Filter Gel'},
                {value: '06', text: 'NAF Absolute HEPA V-Type'}
            ],
            '01-04': [
                {value: '01', text: 'NAF ULPA Filter Minipleat U15-U16'},
                {value: '02', text: 'NAF ULPA Filter Deepleat U15-U16'}
            ],
            '01-05': [
                {value: '01', text: 'NAF V-PAC GT'},
                {value: '02', text: 'NAF PAC GT'},
                {value: '03', text: 'NAF HP GT'},
                {value: '04', text: 'NAF 30 GT'},
                {value: '05', text: 'NAF RIGID GT'},
                {value: '06', text: 'NAF Profile Square End Cap Cartridge Filter'},
                {value: '07', text: 'NAF Profile Cylindrical Cartridge Filter'},
                {value: '08', text: 'NAF Profile Conical Cartridge Filter'},
                {value: '09', text: 'NAF Profile Spunbond Cartridge Filter'}
            ],
            '02-01': [
                {value: '01', text: 'Air Shower Cleanroom'},
                {value: '02', text: 'Pass Box Stainless Cleanroom'},
                {value: '03', text: 'Passbox Air Shower'},
                {value: '04', text: 'Dynamic Passbox Stainless Steel'},
                {value: '05', text: 'Laminar Air Flow / Biological Safety Cabinet (BSC)'},
                {value: '06', text: 'Economic Fan Filter Unit'},
                {value: '07', text: 'Fan Filter Unit'},
                {value: '08', text: 'Fan Filter Unit - American Louver Grille'},
                {value: '09', text: 'NAF Absolute HEPA Ceiling Module Housing Filter'},
                {value: '10', text: 'Side Access Housing Filter'},
                {value: '11', text: 'Supply Air Grille'},
                {value: '12', text: 'Swirl Diffuser Grille'}
            ],
            '02-02': [
                {value: '01', text: 'BIBO Filter Housing'},
                {value: '02', text: 'Air Purifier HEPA 3 IN 1 Unit'},
                {value: '03', text: 'Ranjang Periksa Pasien Stainless Steel'},
                {value: '04', text: 'Troll Tabung Oksigen Stainless Steel'},
                {value: '05', text: 'Meja Stainless Steel'},
                {value: '06', text: 'Rak Sepatu Industri Stainless Steel'},
                {value: '07', text: 'Troll Barang Lipat Stainless Steel'}
            ],
            '02-03': [
                {value: '01', text: 'Fan / Kipas / Blower untuk Fan Filter Unit (FFU)'},
                {value: '02', text: 'Farripulse Diaphragm Valve RMF - 45T'},
                {value: '03', text: 'Hinge Door / Engsel Pintu Jendela Passbox'},
                {value: '04', text: 'Jual Dwyer Magnchelic Original (Differential Pressure Gage)'},
                {value: '05', text: 'Jual Dwyer Minihetic II Original (Differential Pressure Gage 2)'},
                {value: '06', text: 'Motor Rotor Centrifugal Blower Air Shower'}
            ],
            '03': [],
            '04': [],
            '05': [],
            '06': []
        };

        // Media options classified by product name with numeric codes
        const mediaOptionsByProduct = {
            // Pre Filter products
            'NAF CR Pre Filter Washable Flange Type': [
                {code: '05', name: 'Washable media filter non woven FNI IDN TH-350'},
                {code: '06', name: 'Washable media filter non woven 350 Sapta'},
                {code: '07', name: 'Washable Ex-China 350 FABRIC'},
                {code: '08', name: 'Washable 350G'},
                {code: '09', name: 'Washable Filter media T.15/500'},
                {code: '10', name: 'Washable Filter media 500 (sapta)'},
                {code: '11', name: 'Washable GA.160 T.14/G4'},
                {code: '14', name: 'Washable IDN 600'},
                {code: '15', name: 'Washable TH.150 T.11'},
                {code: '16', name: 'Washable VF 560 G'},
                {code: '17', name: 'Washable WF100 (Hight Temperature)'}
            ],
            'NAF CR Pre Filter Washable Flat': [
                {code: '05', name: 'Washable media filter non woven FNI IDN TH-350'},
                {code: '06', name: 'Washable media filter non woven 350 Sapta'},
                {code: '07', name: 'Washable Ex-China 350 FABRIC'},
                {code: '08', name: 'Washable 350G'},
                {code: '09', name: 'Washable Filter media T.15/500'},
                {code: '10', name: 'Washable Filter media 500 (sapta)'},
                {code: '11', name: 'Washable GA.160 T.14/G4'},
                {code: '14', name: 'Washable IDN 600'},
                {code: '15', name: 'Washable TH.150 T.11'},
                {code: '16', name: 'Washable VF 560 G'},
                {code: '17', name: 'Washable WF100 (Hight Temperature)'}
            ],
            'NAF CR Pre Filter Washable Pleated Radial': [
                {code: '05', name: 'Washable media filter non woven FNI IDN TH-350'},
                {code: '06', name: 'Washable media filter non woven 350 Sapta'},
                {code: '07', name: 'Washable Ex-China 350 FABRIC'},
                {code: '08', name: 'Washable 350G'},
                {code: '09', name: 'Washable Filter media T.15/500'},
                {code: '10', name: 'Washable Filter media 500 (sapta)'},
                {code: '11', name: 'Washable GA.160 T.14/G4'},
                {code: '14', name: 'Washable IDN 600'},
                {code: '15', name: 'Washable TH.150 T.11'},
                {code: '16', name: 'Washable VF 560 G'},
                {code: '17', name: 'Washable WF100 (Hight Temperature)'}
            ],
            'Pre Filter Carbon Active Granular': [
                {code: '05', name: 'Washable media filter non woven FNI IDN TH-350'},
                {code: '06', name: 'Washable media filter non woven 350 Sapta'},
                {code: '07', name: 'Washable Ex-China 350 FABRIC'},
                {code: '08', name: 'Washable 350G'},
                {code: '09', name: 'Washable Filter media T.15/500'},
                {code: '10', name: 'Washable Filter media 500 (sapta)'},
                {code: '11', name: 'Washable GA.160 T.14/G4'},
                {code: '14', name: 'Washable IDN 600'},
                {code: '15', name: 'Washable TH.150 T.11'},
                {code: '16', name: 'Washable VF 560 G'},
                {code: '17', name: 'Washable WF100 (Hight Temperature)'}
            ],
            'Pre Filter NAF 30 (Disposable)': [
                {code: '01', name: 'G3 White Fabric'},
                {code: '02', name: 'G4 White Fabric'},
                {code: '12', name: 'G4 (ex china)'},
                {code: '19', name: 'AW TN40/10 size: 710 mm wide rolls (G4) Tangerding'}
            ],
            'NAF CR Prefilter IU': [
                {code: '01', name: 'G3 White Fabric'},
                {code: '02', name: 'G4 White Fabric'},
                {code: '12', name: 'G4 (ex china)'},
                {code: '19', name: 'AW TN40/10 size: 710 mm wide rolls (G4) Tangerding'}
            ],
            'Paint Stop Filter': [
                {code: '04', name: 'Paint Stop Filter'}
            ],
            'Pre Filter Carbon Radial Pleated': [
                {code: 'CS', name: 'Carbon Sheet'},
                {code: 'CG', name: 'Carbon Granular'}
            ],
            'Pre Filter Saranet Double Layer (Aluminium Frame)': [
                {code: 'CS', name: 'Carbon Sheet'},
                {code: 'CG', name: 'Carbon Granular'} 
            ],
            'Filter Loopseal Flange': [
                {code: '01', name: 'G3 White Fabric'},
                {code: '02', name: 'G4 White Fabric'},
                {code: '12', name: 'G4 (ex china)'},
                {code: '19', name: 'AW TN40/10 size: 710 mm wide rolls (G4) Tangerding'}
            ],
            // Medium Filter products
            'NAF V-PAC (2V)': [
                {code: '01', name: 'Glass Fiber'},
                {code: '02', name: 'Synthetic Fiber'}
            ],
            'NAF V Bank Carbon Filter Active 3V': [
                {code: 'CS', name: 'Carbon Sheet'},
                {code: 'CG', name: 'Carbon Granular'}
            ],
            'NAF V-PAC Carbon Filter': [
                {code: 'CS', name: 'Carbon Sheet'},
                {code: 'CG', name: 'Carbon Granular'}
            ],
            'NAF V-PAC Medium Filter': [
                {code: '01', name: 'Glass Fiber'},
                {code: '02', name: 'Synthetic Fiber'}
            ],
            'NAF Rigid Flange Type Stainless Steel': [
                {code: '01', name: 'Glass Fiber'},
                {code: '02', name: 'Synthetic Fiber'}
            ],
            'NAF RIGID Medium Filter': [
                {code: '01', name: 'Glass Fiber'},
                {code: '02', name: 'Synthetic Fiber'}
            ],
            'NAF Multi Pocket Filter / Medium Bag Filter': [
                {code: '01', name: 'Glass Fiber'},
                {code: '02', name: 'Synthetic Fiber'}
            ],
            'NAF Multi Pocket Airweb': [
                {code: '01', name: 'Glass Fiber'},
                {code: '02', name: 'Synthetic Fiber'}
            ],
            'NAF ECO PAC Seri Karton': [
                {code: '01', name: 'Glass Fiber'},
                {code: '02', name: 'Synthetic Fiber'}
            ],
            'NAF ECO PAC Seri Metal': [
                {code: '01', name: 'Glass Fiber'},
                {code: '02', name: 'Synthetic Fiber'}
            ],
            'NAF PAC': [
                {code: '01', name: 'Glass Fiber'},
                {code: '02', name: 'Synthetic Fiber'}
            ],
            'NAF PAC Wooden Frame': [
                {code: '01', name: 'Glass Fiber'},
                {code: '02', name: 'Synthetic Fiber'}
            ],
            'Medium Filter Carbon Multi Layer (3 Stage)': [
                {code: 'CS', name: 'Carbon Sheet'},
                {code: 'CG', name: 'Carbon Granular'}
            ],
            'NAF Rigid Flange Type Stainless Steel (F9)': [
                {code: '01', name: 'Glass Fiber'},
                {code: '02', name: 'Synthetic Fiber'}
            ],
            // HEPA Filter products
            'NAF Absolute MX': [
                {code: 'H13', name: 'HEPA H13'},
                {code: 'H14', name: 'HEPA H14'}
            ],
            'NAF Absolute HEPA Minipleat XL – Deep 12 Inch': [
                {code: 'H13', name: 'HEPA H13'},
                {code: 'H14', name: 'HEPA H14'}
            ],
            'NAF Absolute HEPA Minipleat XL – Deep 6 Inch': [
                {code: 'H13', name: 'HEPA H13'},
                {code: 'H14', name: 'HEPA H14'}
            ],
            'NAF Absolute XL | HEPA Filter High Capacity (Aluminium Separator)': [
                {code: 'H13', name: 'HEPA H13'},
                {code: 'H14', name: 'HEPA H14'}
            ],
            'NAF Absolute HEPA Filter Gel': [
                {code: 'H13', name: 'HEPA H13'},
                {code: 'H14', name: 'HEPA H14'}
            ],
            'NAF Absolute HEPA V-Type': [
                {code: 'H13', name: 'HEPA H13'},
                {code: 'H14', name: 'HEPA H14'}
            ],
            // ULPA Filter products
            'NAF ULPA Filter Minipleat U15-U16': [
                {code: 'U15', name: 'ULPA U15'},
                {code: 'U16', name: 'ULPA U16'}
            ],
            'NAF ULPA Filter Deepleat U15-U16': [
                {code: 'U15', name: 'ULPA U15'},
                {code: 'U16', name: 'ULPA U16'}
            ],
            // Gasturbine products
            'NAF V-PAC GT': [
                {code: '01', name: 'Glass Fiber'},
                {code: '02', name: 'Synthetic Fiber'}
            ],
            'NAF PAC GT': [
                {code: '01', name: 'Glass Fiber'},
                {code: '02', name: 'Synthetic Fiber'}
            ],
            'NAF HP GT': [
                {code: '01', name: 'Glass Fiber'},
                {code: '02', name: 'Synthetic Fiber'}
            ],
            'NAF 30 GT': [
                {code: '01', name: 'Glass Fiber'},
                {code: '02', name: 'Synthetic Fiber'}
            ],
            'NAF RIGID GT': [
                {code: '01', name: 'Glass Fiber'},
                {code: '02', name: 'Synthetic Fiber'}
            ],
            'NAF Profile Square End Cap Cartridge Filter': [
                {code: '01', name: 'Glass Fiber'},
                {code: '02', name: 'Synthetic Fiber'}
            ],
            'NAF Profile Cylindrical Cartridge Filter': [
                {code: '01', name: 'Glass Fiber'},
                {code: '02', name: 'Synthetic Fiber'}
            ],
            'NAF Profile Conical Cartridge Filter': [
                {code: '01', name: 'Glass Fiber'},
                {code: '02', name: 'Synthetic Fiber'}
            ],
            'NAF Profile Spunbond Cartridge Filter': [
                {code: '01', name: 'Glass Fiber'},
                {code: '02', name: 'Synthetic Fiber'}
            ]
        };

        // Load saved options from localStorage
        function loadSavedOptions() {
            const saved = localStorage.getItem('savedOptions');
            if (saved) {
                savedOptions = JSON.parse(saved);
            } else {
                // Initialize with default categories
                savedOptions.categories = [
                    {value: '01', text: '01. Filter'},
                    {value: '02', text: '02. Sheetmetal'},
                    {value: '03', text: '03. Bahan baku'},
                    {value: '04', text: '04. Barang jadi'},
                    {value: '05', text: '05. Jasa'},
                    {value: '06', text: '06. Subcount'}
                ];
                
                // Initialize with default subcategories
                savedOptions.subCategories = defaultSubCategories;
                
                // Initialize with default product names
                savedOptions.productNames = defaultProductNames;
                
                // Initialize with empty materials
                savedOptions.materials = [];
                
                saveOptionsToStorage();
            }
            
            // Populate category dropdown
            const categorySelect = document.getElementById('category');
            categorySelect.innerHTML = '<option value="">-- Pilih Kategori --</option>';
            savedOptions.categories.forEach(cat => {
                categorySelect.add(new Option(cat.text, cat.value));
            });
        }

        // Save options to localStorage
        function saveOptionsToStorage() {
            localStorage.setItem('savedOptions', JSON.stringify(savedOptions));
        }

        // Update subcategories based on selected category
        function updateSubCategories() {
            const category = document.getElementById('category').value;
            const subCategorySelect = document.getElementById('subCategory');
            const productNameSelect = document.getElementById('productName');
            const materialSelect = document.getElementById('material');
            
            // Reset dependent dropdowns
            productNameSelect.innerHTML = '<option value="">-- Pilih Nama Product --</option>';
            productNameSelect.disabled = true;
            materialSelect.innerHTML = '<option value="">-- Pilih Bahan/Media --</option>';
            materialSelect.disabled = true;
            document.getElementById('materialAddBtn').disabled = true;
            
            if (!category) {
                subCategorySelect.innerHTML = '<option value="">-- Pilih Sub Kategori --</option>';
                subCategorySelect.disabled = true;
                return;
            }
            
            subCategorySelect.innerHTML = '<option value="">-- Pilih Sub Kategori --</option>';
            const subCategories = savedOptions.subCategories[category] || [];
            
            subCategories.forEach(subCat => {
                subCategorySelect.add(new Option(subCat.text, subCat.value));
            });
            
            subCategorySelect.disabled = false;
        }

        // Update product names based on selected category and subcategory
        function updateProductNames() {
            const category = document.getElementById('category').value;
            const subCategory = document.getElementById('subCategory').value;
            const productNameSelect = document.getElementById('productName');
            const materialSelect = document.getElementById('material');
            
            // Reset material dropdown
            materialSelect.innerHTML = '<option value="">-- Pilih Bahan/Media --</option>';
            materialSelect.disabled = true;
            document.getElementById('materialAddBtn').disabled = true;
            
            if (!category || !subCategory) {
                productNameSelect.innerHTML = '<option value="">-- Pilih Nama Product --</option>';
                productNameSelect.disabled = true;
                return;
            }
            
            const key = `${category}-${subCategory}`;
            const productNames = savedOptions.productNames[key] || [];
            
            productNameSelect.innerHTML = '<option value="">-- Pilih Nama Product --</option>';
            productNames.forEach(product => {
                productNameSelect.add(new Option(product.text, product.value));
            });
            
            productNameSelect.disabled = false;
            
            // Show pocket input for Multi Pocket Filter
            const pocketInputGroup = document.getElementById('pocketInputGroup');
            if (productNameSelect.options[productNameSelect.selectedIndex]?.text.includes('Multi Pocket')) {
                pocketInputGroup.style.display = 'block';
            } else {
                pocketInputGroup.style.display = 'none';
            }
        }

        // Update material options based on selected product name
        function updateMaterialOptions() {
            const productNameSelect = document.getElementById('productName');
            const materialSelect = document.getElementById('material');
            const selectedProduct = productNameSelect.options[productNameSelect.selectedIndex]?.text;
            
            materialSelect.innerHTML = '<option value="">-- Pilih Bahan/Media --</option>';
            
            if (!selectedProduct) {
                materialSelect.disabled = true;
                document.getElementById('materialAddBtn').disabled = true;
                return;
            }
            
            // Check if this product has predefined media options
            const mediaOptions = mediaOptionsByProduct[selectedProduct];
            
            if (mediaOptions && mediaOptions.length > 0) {
                mediaOptions.forEach(media => {
                    materialSelect.add(new Option(media.name, media.code));
                });
                document.getElementById('materialAddBtn').disabled = true;
            } else {
                // Load saved materials for this product
                const savedMaterials = savedOptions.materials.filter(m => m.product === selectedProduct);
                
                if (savedMaterials.length > 0) {
                    savedMaterials.forEach(material => {
                        materialSelect.add(new Option(material.name, material.code));
                    });
                } else {
                    materialSelect.add(new Option('-- No materials defined --', ''));
                }
                
                document.getElementById('materialAddBtn').disabled = false;
            }
            
            materialSelect.disabled = false;
        }

        // Generate size code from dimensions
        function generateSizeCode() {
            const length = document.getElementById('length').value;
            const width = document.getElementById('width').value;
            const height = document.getElementById('height').value;
            
            let sizeCode = '';
            
            if (length) sizeCode += `L${length.padStart(4, '0')}`;
            if (width) sizeCode += `W${width.padStart(4, '0')}`;
            if (height) sizeCode += `H${height.padStart(4, '0')}`;
            
            document.getElementById('sizeCode').value = sizeCode;
        }

        // Generate part number
        function generatePartNumber() {
            const category = document.getElementById('category').value;
            const subCategory = document.getElementById('subCategory').value;
            const productName = document.getElementById('productName').value;
            const material = document.getElementById('material').value;
            const sizeCode = document.getElementById('sizeCode').value;
            const price = document.getElementById('price').value;
            
            // Validate required fields
            if (!category || !subCategory || !productName || !material) {
                alert('Please fill in all required fields: Kategori, Sub Kategori, Nama Product, and Bahan/Media');
                return;
            }
            
            // Get selected text values for QR code
            const categoryText = document.getElementById('category').options[document.getElementById('category').selectedIndex].text;
            const subCategoryText = document.getElementById('subCategory').options[document.getElementById('subCategory').selectedIndex].text;
            const productNameText = document.getElementById('productName').options[document.getElementById('productName').selectedIndex].text;
            const materialText = document.getElementById('material').options[document.getElementById('material').selectedIndex].text;
            
            // Check for pocket count if this is a Multi Pocket Filter
            let pocketCount = '';
            if (productNameText.includes('Multi Pocket')) {
                pocketCount = document.getElementById('pocketCount').value;
                if (!pocketCount || isNaN(pocketCount) {
                    alert('Please enter a valid number of pockets for Multi Pocket Filter');
                    return;
                }
                pocketCount = `P${pocketCount.padStart(2, '0')}`;
            }
            
            // Generate part number
            let partNumber = `${category}${subCategory}${productName}${material}`;
            if (pocketCount) partNumber += pocketCount;
            if (sizeCode) partNumber += `-${sizeCode}`;
            
            // Generate QR data
            let qrData = `Part Number: ${partNumber}\n`;
            qrData += `Kategori: ${categoryText}\n`;
            qrData += `Sub Kategori: ${subCategoryText}\n`;
            qrData += `Produk: ${productNameText}\n`;
            qrData += `Material: ${materialText}\n`;
            if (sizeCode) qrData += `Ukuran: ${sizeCode}\n`;
            if (price) qrData += `Harga: Rp ${parseInt(price).toLocaleString('id-ID')}\n`;
            
            // Display results
            document.getElementById('partNumber').value = partNumber;
            document.getElementById('qrData').value = qrData;
            document.getElementById('qr-text').textContent = qrData;
            
            // Generate QR code
            const qrCodeDiv = document.getElementById('qr-code');
            qrCodeDiv.innerHTML = '';
            new QRCode(qrCodeDiv, {
                text: qrData,
                width: 200,
                height: 200,
                colorDark: "#000000",
                colorLight: "#ffffff",
                correctLevel: QRCode.CorrectLevel.H
            });
            
            // Show result section
            document.getElementById('result').style.display = 'block';
            
            // Save to data table
            saveToDataTable(partNumber, categoryText, subCategoryText, productNameText, materialText, sizeCode, price);
        }

        // Save generated part number to data table
        function saveToDataTable(partNumber, category, subCategory, product, material, size, price) {
            let savedData = JSON.parse(localStorage.getItem('partNumberData') || '[]');
            
            // Check if this part number already exists
            const existingIndex = savedData.findIndex(item => item.partNumber === partNumber);
            
            const dataItem = {
                partNumber,
                category,
                subCategory,
                product,
                material,
                size: size || '-',
                price: price ? `Rp ${parseInt(price).toLocaleString('id-ID')}` : '-',
                timestamp: new Date().toISOString()
            };
            
            if (existingIndex >= 0) {
                // Update existing entry
                savedData[existingIndex] = dataItem;
            } else {
                // Add new entry
                savedData.push(dataItem);
            }
            
            localStorage.setItem('partNumberData', JSON.stringify(savedData));
            updateDataTable();
        }

        // Update data table with saved part numbers
        function updateDataTable(filterCategory = 'all', searchTerm = '') {
            const savedData = JSON.parse(localStorage.getItem('partNumberData') || '[]');
            const tableBody = document.getElementById('tableBody');
            
            tableBody.innerHTML = '';
            
            if (savedData.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="9" class="no-data">Belum ada data</td></tr>';
                return;
            }
            
            // Filter data by category if specified
            let filteredData = savedData;
            if (filterCategory !== 'all') {
                filteredData = savedData.filter(item => 
                    item.category.startsWith(filterCategory + '.') || 
                    item.category.startsWith(filterCategory + ' ')
                );
            }
            
            // Apply search filter if search term exists
            if (searchTerm) {
                const term = searchTerm.toLowerCase();
                filteredData = filteredData.filter(item => 
                    item.partNumber.toLowerCase().includes(term) ||
                    item.category.toLowerCase().includes(term) ||
                    item.subCategory.toLowerCase().includes(term) ||
                    item.product.toLowerCase().includes(term) ||
                    item.material.toLowerCase().includes(term) ||
                    item.size.toLowerCase().includes(term)
                );
            }
            
            if (filteredData.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="9" class="no-data">Tidak ada data yang cocok</td></tr>';
                return;
            }
            
            // Sort by timestamp (newest first)
            filteredData.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
            
            // Populate table
            filteredData.forEach((item, index) => {
                const row = document.createElement('tr');
                
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${item.partNumber}</td>
                    <td>${item.category}</td>
                    <td>${item.subCategory}</td>
                    <td>${item.product}</td>
                    <td>${item.material}</td>
                    <td>${item.size}</td>
                    <td>${item.price}</td>
                    <td class="action-buttons">
                        <button class="action-btn view-btn" onclick="viewItem('${item.partNumber}')">View</button>
                        <button class="action-btn delete-btn" onclick="deleteItem('${item.partNumber}')">Delete</button>
                    </td>
                `;
                
                tableBody.appendChild(row);
            });
        }

        // View item details
        function viewItem(partNumber) {
            const savedData = JSON.parse(localStorage.getItem('partNumberData') || '[]');
            const item = savedData.find(i => i.partNumber === partNumber);
            
            if (!item) {
                alert('Item not found');
                return;
            }
            
            // Display the item in the form
            document.getElementById('partNumber').value = item.partNumber;
            document.getElementById('qrData').value = `Part Number: ${item.partNumber}\nKategori: ${item.category}\nSub Kategori: ${item.subCategory}\nProduk: ${item.product}\nMaterial: ${item.material}\nUkuran: ${item.size}\nHarga: ${item.price}`;
            document.getElementById('qr-text').textContent = `Part Number: ${item.partNumber}\nKategori: ${item.category}\nSub Kategori: ${item.subCategory}\nProduk: ${item.product}\nMaterial: ${item.material}\nUkuran: ${item.size}\nHarga: ${item.price}`;
            
            // Generate QR code
            const qrCodeDiv = document.getElementById('qr-code');
            qrCodeDiv.innerHTML = '';
            new QRCode(qrCodeDiv, {
                text: `Part Number: ${item.partNumber}\nKategori: ${item.category}\nSub Kategori: ${item.subCategory}\nProduk: ${item.product}\nMaterial: ${item.material}\nUkuran: ${item.size}\nHarga: ${item.price}`,
                width: 200,
                height: 200,
                colorDark: "#000000",
                colorLight: "#ffffff",
                correctLevel: QRCode.CorrectLevel.H
            });
            
            // Show result section
            document.getElementById('result').style.display = 'block';
            
            // Scroll to result section
            document.getElementById('result').scrollIntoView({ behavior: 'smooth' });
        }

        // Delete item from data table
        function deleteItem(partNumber) {
            if (!confirm('Are you sure you want to delete this item?')) {
                return;
            }
            
            let savedData = JSON.parse(localStorage.getItem('partNumberData') || '[]');
            savedData = savedData.filter(item => item.partNumber !== partNumber);
            
            localStorage.setItem('partNumberData', JSON.stringify(savedData));
            updateDataTable();
        }

        // Clear all data
        function clearAllData() {
            if (!confirm('Are you sure you want to delete ALL data? This cannot be undone.')) {
                return;
            }
            
            localStorage.removeItem('partNumberData');
            updateDataTable();
        }

        // Export data to Excel
        function exportToExcel() {
            const savedData = JSON.parse(localStorage.getItem('partNumberData') || '[]');
            
            if (savedData.length === 0) {
                alert('No data to export');
                return;
            }
            
            // Prepare worksheet
            const wsData = [
                ['No', 'Part Number', 'Kategori', 'Sub Kategori', 'Produk', 'Material', 'Ukuran', 'Harga', 'Tanggal Dibuat']
            ];
            
            savedData.forEach((item, index) => {
                wsData.push([
                    index + 1,
                    item.partNumber,
                    item.category,
                    item.subCategory,
                    item.product,
                    item.material,
                    item.size,
                    item.price,
                    new Date(item.timestamp).toLocaleString('id-ID')
                ]);
            });
            
            const ws = XLSX.utils.aoa_to_sheet(wsData);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'Part Numbers');
            
            // Generate file name with current date
            const dateStr = new Date().toISOString().slice(0, 10);
            XLSX.writeFile(wb, `PartNumbers_${dateStr}.xlsx`);
        }

        // Filter data table by category
        function filterDataTable(category) {
            // Update active tab
            const tabs = document.querySelectorAll('.category-tab');
            tabs.forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');
            
            // Update table
            const searchTerm = document.getElementById('searchInput').value;
            updateDataTable(category, searchTerm);
        }

        // Search table
        function searchTable() {
            const searchTerm = document.getElementById('searchInput').value;
            const activeTab = document.querySelector('.category-tab.active');
            const category = activeTab ? activeTab.getAttribute('onclick').match(/'([^']+)'/)[1] : 'all';
            
            updateDataTable(category, searchTerm);
        }

        // Copy text to clipboard
        function copyToClipboard(elementId) {
            const element = document.getElementById(elementId);
            element.select();
            document.execCommand('copy');
            
            // Show temporary tooltip
            const originalText = event.target.textContent;
            event.target.textContent = 'Copied!';
            setTimeout(() => {
                event.target.textContent = originalText;
            }, 2000);
        }

        // Save QR code as image
        function saveQRCode(format) {
            const qrCodeDiv = document.getElementById('qr-code');
            
            html2canvas(qrCodeDiv).then(canvas => {
                const link = document.createElement('a');
                link.download = `QRCode_${document.getElementById('partNumber').value}.${format}`;
                link.href = canvas.toDataURL(`image/${format}`);
                link.click();
            });
        }

        // Show add option modal
        function showAddOptionModal(fieldType) {
            const modal = document.getElementById('addOptionModal');
            const title = document.getElementById('addOptionTitle');
            const categorySelection = document.getElementById('categorySelection');
            const subCategorySelection = document.getElementById('subCategorySelection');
            const codeFieldGroup = document.getElementById('codeFieldGroup');
            
            // Reset form
            document.getElementById('newOptionCode').value = '';
            document.getElementById('newOptionName').value = '';
            
            // Set modal title and fields based on field type
            if (fieldType === 'subCategory') {
                title.textContent = 'Add New Sub Category';
                categorySelection.style.display = 'block';
                subCategorySelection.style.display = 'none';
                codeFieldGroup.style.display = 'block';
                
                // Populate parent category dropdown
                const parentCategory = document.getElementById('parentCategory');
                parentCategory.innerHTML = '<option value="">-- Select Category --</option>';
                savedOptions.categories.forEach(cat => {
                    parentCategory.add(new Option(cat.text, cat.value));
                });
            } 
            else if (fieldType === 'productName') {
                title.textContent = 'Add New Product Name';
                categorySelection.style.display = 'block';
                subCategorySelection.style.display = 'block';
                codeFieldGroup.style.display = 'block';
                
                // Populate parent category dropdown
                const parentCategory = document.getElementById('parentCategory');
                parentCategory.innerHTML = '<option value="">-- Select Category --</option>';
                savedOptions.categories.forEach(cat => {
                    parentCategory.add(new Option(cat.text, cat.value));
                });
                
                // Update subcategories when category changes
                parentCategory.onchange = function() {
                    const parentSubCategory = document.getElementById('parentSubCategory');
                    parentSubCategory.innerHTML = '<option value="">-- Select Sub Category --</option>';
                    
                    if (!this.value) return;
                    
                    const subCategories = savedOptions.subCategories[this.value] || [];
                    subCategories.forEach(subCat => {
                        parentSubCategory.add(new Option(subCat.text, subCat.value));
                    });
                };
            } 
            else if (fieldType === 'material') {
                title.textContent = 'Add New Material';
                categorySelection.style.display = 'none';
                subCategorySelection.style.display = 'none';
                codeFieldGroup.style.display = 'block';
            }
            
            // Store field type in modal for later use
            modal.dataset.fieldType = fieldType;
            
            // Show modal
            modal.style.display = 'block';
        }

        // Close add option modal
        function closeAddOptionModal() {
            document.getElementById('addOptionModal').style.display = 'none';
        }

        // Save new option
        function saveNewOption() {
            const modal = document.getElementById('addOptionModal');
            const fieldType = modal.dataset.fieldType;
            const code = document.getElementById('newOptionCode').value;
            const name = document.getElementById('newOptionName').value;
            
            if (!name) {
                alert('Name is required');
                return false;
            }
            
            if (fieldType === 'subCategory') {
                const parentCategory = document.getElementById('parentCategory').value;
                if (!parentCategory) {
                    alert('Please select a category');
                    return false;
                }
                
                // Check if code is provided and unique for this category
                if (!code) {
                    alert('Code is required for sub category');
                    return false;
                }
                
                const existingSubCat = (savedOptions.subCategories[parentCategory] || []).find(sc => sc.value === code);
                if (existingSubCat) {
                    alert('A sub category with this code already exists for the selected category');
                    return false;
                }
                
                // Add new sub category
                if (!savedOptions.subCategories[parentCategory]) {
                    savedOptions.subCategories[parentCategory] = [];
                }
                
                savedOptions.subCategories[parentCategory].push({
                    value: code,
                    text: `${code.padStart(2, '0')}. ${name}`
                });
                
                // Sort subcategories by code
                savedOptions.subCategories[parentCategory].sort((a, b) => a.value.localeCompare(b.value));
                
                // If this is a new category-subcategory combination, initialize product names array
                const key = `${parentCategory}-${code}`;
                if (!savedOptions.productNames[key]) {
                    savedOptions.productNames[key] = [];
                }
            } 
            else if (fieldType === 'productName') {
                const parentCategory = document.getElementById('parentCategory').value;
                const parentSubCategory = document.getElementById('parentSubCategory').value;
                
                if (!parentCategory || !parentSubCategory) {
                    alert('Please select category and sub category');
                    return false;
                }
                
                // Check if code is provided and unique for this sub category
                if (!code) {
                    alert('Code is required for product name');
                    return false;
                }
                
                const key = `${parentCategory}-${parentSubCategory}`;
                const existingProduct = (savedOptions.productNames[key] || []).find(p => p.value === code);
                if (existingProduct) {
                    alert('A product with this code already exists for the selected sub category');
                    return false;
                }
                
                // Add new product name
                if (!savedOptions.productNames[key]) {
                    savedOptions.productNames[key] = [];
                }
                
                savedOptions.productNames[key].push({
                    value: code,
                    text: name
                });
                
                // Sort products by code
                savedOptions.productNames[key].sort((a, b) => a.value.localeCompare(b.value));
            } 
            else if (fieldType === 'material') {
                const productNameSelect = document.getElementById('productName');
                const productName = productNameSelect.options[productNameSelect.selectedIndex]?.text;
                
                if (!productName) {
                    alert('Please select a product first');
                    return false;
                }
                
                // Check if code is provided
                if (!code) {
                    alert('Code is required for material');
                    return false;
                }
                
                // Check if this material already exists for this product
                const existingMaterial = savedOptions.materials.find(m => 
                    m.product === productName && (m.code === code || m.name === name)
                );
                
                if (existingMaterial) {
                    alert('A material with this code or name already exists for the selected product');
                    return false;
                }
                
                // Add new material
                savedOptions.materials.push({
                    product: productName,
                    code: code,
                    name: name
                });
            }
            
            // Save to storage and update UI
            saveOptionsToStorage();
            
            if (fieldType === 'subCategory') {
                updateSubCategories();
            } 
            else if (fieldType === 'productName') {
                updateProductNames();
            } 
            else if (fieldType === 'material') {
                updateMaterialOptions();
            }
            
            // Close modal
            closeAddOptionModal();
            return false;
        }

        // Login functions
        function showLoginModal() {
            document.getElementById('loginModal').style.display = 'block';
        }

        function validateLogin() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            // Simple validation (in a real app, this would be server-side)
            if (username === 'admin' && password === 'admin123') {
                document.getElementById('loginModal').style.display = 'none';
                document.getElementById('mainContent').style.display = 'block';
                return false;
            } else {
                document.getElementById('loginError').style.display = 'block';
                return false;
            }
        }

        // Initialize application
        window.onload = function() {
            showLoginModal();
            loadSavedOptions();
            
            // Set up event listeners
            document.getElementById('searchInput').addEventListener('keyup', function(event) {
                if (event.key === 'Enter') {
                    searchTable();
                }
            });
        };
    </script>
</body>
</html>
